{% if project_type == "standalone" -%}
# CLAUDE.md

This file provides guidance for Claude (or any AI assistant) working on this project.

## Project Overview

**{{ project_name }}** — {{ description or "A Python project." }}

## Tech Stack

- **Python {{ python_version }}+** with **uv** for package/environment management
- **Ruff** for linting and formatting (ALL rules enabled)
- **Pyrefly** for static type checking (strict mode)
- **Pytest** for testing (with coverage via pytest-cov)
- **Just** as task runner
- **Pre-commit** for git hooks

## Key Commands

```bash
just setup         # First-time: install deps + pre-commit hooks
just check         # Run ALL checks (lint + format + typecheck + test)
just lint-fix      # Ruff linter with auto-fix
just format        # Ruff formatter
just typecheck     # Pyrefly type checker
just test          # Pytest
just test-cov      # Pytest with coverage
```

## Code Conventions

- **Ruff** with `select = ["ALL"]` — every rule enabled, explicit ignores in pyproject.toml.
- **Google-style** docstrings.
- **Pyrefly strict** — all parameters must have type annotations.
- **Coverage threshold: 80%**.
- Always run `just check` before committing.
- Pre-commit hooks enforce formatting automatically.

## Project Layout

```
src/{{ module_name }}/    # Source code
tests/                    # Tests (no docstrings/annotations required)
pyproject.toml            # All tool configuration
justfile                  # Developer commands
```

{% else -%}
# CLAUDE.md

This file provides guidance for Claude (or any AI assistant) working on this monorepo.

## Overview

**{{ project_name }}** — {{ description or "A Python monorepo." }}

This is a **uv workspace** containing multiple Python packages.
Each package has its own `CLAUDE.md` with package-specific context.

## Packages

{% for pkg in packages -%}
- **{{ pkg }}** — `{{ pkg }}/` (see `{{ pkg }}/CLAUDE.md`)
{% endfor %}

## Tech Stack

- **Python {{ python_version }}+** with **uv workspaces** (single lockfile)
- **Ruff** for linting and formatting (ALL rules enabled, configured at root)
- **Pyrefly** for static type checking (strict mode)
- **Pytest** for testing (with coverage via pytest-cov)
- **Just** as task runner
- **Pre-commit** for git hooks

## Key Commands

```bash
just setup             # First-time: install deps + pre-commit hooks
just check             # Run ALL checks across all packages
just test-pkg <name>   # Test a single package
just lint-fix          # Fix lint issues across all packages
just format            # Format all code
```

## Architecture & Conventions

- **Shared config at root**: Ruff rules, Pyrefly settings, pytest options, and dev dependencies
  all live in the root `pyproject.toml`. Sub-packages inherit automatically.
- **Per-package**: Each package has its own `pyproject.toml` for package metadata,
  build system, and coverage source. No tool config duplication.
- **Coverage threshold: 80%** (enforced at root).
- Always run `just check` before committing. Pre-commit hooks enforce formatting.

## Monorepo Layout

```
{{ project_name }}/
├── pyproject.toml              # Workspace definition, shared tool config, dev deps
├── justfile                    # Root commands (orchestrates all packages)
├── CLAUDE.md                   # This file (repo-wide context)
{% for pkg in packages -%}
├── {{ pkg }}/
│   ├── pyproject.toml          # Package metadata + build system
│   ├── CLAUDE.md               # Package-specific context
│   ├── justfile                # Package-specific commands
│   ├── src/{{ pkg | replace('-', '_') }}/
│   └── tests/
{% endfor -%}
├── .pre-commit-config.yaml
├── .github/workflows/ci.yml
└── .copier-answers.yml
```

## Adding a New Package

Run `copier update` and add the new package name to the `packages` list.
{% endif -%}
